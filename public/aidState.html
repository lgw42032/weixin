﻿<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <link rel="stylesheet" href="css/base.css"/>
    <link rel="stylesheet" href="css/aidState.css"/>
    <link rel="stylesheet" href="js/libs/dropload-gh-pages/dist/dropload.css">

    <title>急救动态</title>
    <style>




        .content{
            margin: 0 auto;
            background-color: #fff;
        }
        .content .item{
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-align:center;
            -webkit-box-align:center;
            box-align:center;
            -webkit-align-items:center;
            align-items:center;
            padding:3.125%;
            border-bottom: 1px solid #ddd;
            color: #333;
            text-decoration: none;
        }
        .content .item img{
            display: block;
            width: 1rem;
            /*height: 40px;*/
            border:1px solid #ddd;
        }
        .content .item h3{
            display: block;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -ms-flex: 1;
            flex: 1;
            width: 100%;
            max-height: 40px;
            overflow: hidden;
            line-height: 20px;
            margin: 0 10px;
            /*font-size: 1.2rem;*/
        }
        .content .item .date{
            display: block;
            height: 20px;
            line-height: 20px;
            color: #999;
        }
        .opacity{
            -webkit-animation: opacity 0.3s linear;
            animation: opacity 0.3s linear;
        }
        @-webkit-keyframes opacity {
            0% {
                opacity:0;
            }
            100% {
                opacity:1;
            }
        }
        @keyframes opacity {
            0% {
                opacity:0;
            }
            100% {
                opacity:1;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div>
            <h2><img src="images/120.png" alt=""/>&nbsp;急救助手</h2>
            <p>急救动态</p>
        </div>
    </header>
    <section class="content" >
        <ul class="lists">

        </ul>
    </section>
    <script src="js/libs/jquery-3.2.1.min.js"></script>
    <script src="js/libs/dropload-gh-pages/dist/dropload.min.js"></script>
    <script src="js/libs/pxToRem.js"></script>
    <script>
        var headerHeight =  $('header').outerHeight();
        console.log(headerHeight);
        $('.content').css('height',document.documentElement.clientHeight - headerHeight+'px');

    </script>
    <script>
        //js 读取文件
        function fmtDate(obj){
            var date =  new Date(obj);
            var y = 1900+date.getYear();
            var m = "0"+(date.getMonth()+1);
            var d = "0"+date.getDate();
            return y+"-"+m.substring(m.length-2,m.length)+"-"+d.substring(d.length-2,d.length);
        }

        $(function(){
                // 页数
                var page = 0;
                // 每页展示5个
                var size = 5;
//                var token = localStorage.getItem('token');

                // dropload
                $('.content').dropload({
                    scrollArea : window,
                    loadDownFn : function(me){
                        page++;
                        // 拼接HTML
                        var result = '';
                        $.ajax({
                            type: 'post',
                            url:'/getNews',
                            data:{ "type":"news","offset": (page-1)*size ,"count":size},
                            success: function(news){
                                let data = news.data.item;
                                var arrLen = data.length;

                                var a = {
                                    "item": [
                                        {
                                            "media_id":"x92MtJGmsNaciXksZ_Zw3GVwKY5oxLJMfpU_1UvBrQQ",
                                            "content":{
                                                "news_item":[
                                                    {
                                                        "title":"测试",
                                                        "author":"lgw",
                                                        "digest":"测试文章",
                                                        "content":"<p>测试文章<\/p><p><img class=\"\" data-copyright=\"0\" data-ratio=\"0.5\" data-s=\"300,640\" data-src=\"https:\/\/mmbiz.qpic.cn\/mmbiz_png\/6lPVBc8YvmkF9ofM0cm01p3ryGtTLXeRO5tU2fApap3MVbQ2H3a1w4z0W3brJRzYO7lMt3h4pQdQFY9icib7lnOw\/640?wx_fmt=png\" data-type=\"png\" data-w=\"50\" style=\"\"  \/><\/p><p><br  \/><\/p>",
                                                        "content_source_url":"",
                                                        "thumb_media_id":"x92MtJGmsNaciXksZ_Zw3A0V8CCPn00hq3TpvgRZN30",
                                                        "show_cover_pic":0,
                                                        "url":"http:\/\/mp.weixin.qq.com\/s?__biz=MzA5Njc0NTU3MQ==&mid=100000002&idx=1&sn=f30d6ac25c089d4fac1f7ab0923d9bf8&chksm=10aa200e27dda91836ddb4408a15ffbac5baba35bcdc1c36b5a46ebee01857dd16e768a2086c#rd",
                                                        "thumb_url":"http:\/\/mmbiz.qpic.cn\/mmbiz_jpg\/6lPVBc8YvmkF9ofM0cm01p3ryGtTLXeRtgmTXmno8ib6bO4icxpYy6ibOC2icYmiazE8Hr17BYpicymKx8v7KNXllv9w\/0?wx_fmt=jpeg",
                                                        "need_open_comment":1,
                                                        "only_fans_can_comment":0
                                                    }
                                                ],
                                                "create_time":1524044442,
                                                "update_time":1524044629
                                            },
                                            "update_time":1524044629}
                                    ],
                                    "total_count":1,
                                    "item_count":1
                                }

                                if(arrLen > 0){
                                for(var i=0; i<arrLen; i++){
                                    var newItem = data[i].content.news_item;
                                    for(var j=0;j<newItem.length;j++){

                                        result +=   '<a class="item opacity" href="'+ newItem[j].url.replace('"','').replace(/[\\]/g,'')+'">'
                                                +'<img src="'+ newItem[j].thumb_url.replace('"','').replace(/[\\]/g,'')+'" alt="">'
                                                +'<h3>'+ newItem[j].title+'</h3>'
                                                +'<span class="date">'+ fmtDate( data[i].content.update_time) +'</span>'
                                                +'</a>';
                                    }

                                }
                                    // 如果没有数据
                                }else{
                                    // 锁定
                                    me.lock();
                                    // 无数据
                                    me.noData();
                                }
                                // 为了测试，延迟1秒加载
                                setTimeout(function(){
                                    // 插入数据到页面，放到最后面
                                    $('.lists').append(result);
                                    // 每次数据插入，必须重置
                                    me.resetload();
                                },1000);
                            },
                            error: function(err){

                                alert('error');
                                // 即使加载出错，也得重置
                                me.resetload();
                            }
                        });
                    }
                });


        });
    </script>

</body>
</html>